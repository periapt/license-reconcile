#!/usr/bin/perl

use Test::More tests => 5;
use Test::LongString;
use Test::Deep;
use Debian::LicenseReconcile::Errors;
use Debian::LicenseReconcile::CopyrightTarget;
use File::Slurp;

is(Debian::LicenseReconcile::Errors->how_many,0,'how many');
my @list = Debian::LicenseReconcile::Errors->list;
cmp_deeply(\@list, [], 'initial state');

my $copyright = Debian::LicenseReconcile::CopyrightTarget->new;
isa_ok($copyright, 'Debian::LicenseReconcile::CopyrightTarget');
isa_ok($copyright->parse(scalar read_file('t/data/mysql')),'Debian::LicenseReconcile::CopyrightTarget');
my $s =<<'EOS';
cmd-line-utils: 
 libedit: 
  config.h: GPL-2, UNKNOWN...
  *: BSD (3 clause), 1989-1990,1992-1993 The Regents of the University of California....
  filecomplete.c: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
  filecomplete.h: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
  np: 
   fgetln.c: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
   strlcat.c: ISC, 1998 Todd C. Miller <Todd.Miller@courtesan.com>...
   strlcpy.c: ISC, 1998 Todd C. Miller <Todd.Miller@courtesan.com>...
   vis.c: BSD (3 clause), 1989-1993 The Regents of the University of California....
  read.h: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
  readline.c: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
  readline: 
   *: BSD (2 clause), 1997-2001 The NetBSD Foundation Inc...
 readline: 
  *: GPL-2+, 1987-2006 Free Software Foundation Inc...
dbug: 
 example1.c: GPL-2, UNKNOWN...
 example2.c: GPL-2, UNKNOWN...
 example3.c: GPL-2, UNKNOWN...
 factorial.c: GPL-2, UNKNOWN...
 main.c: GPL-2, UNKNOWN...
 my_main.c: GPL-2, UNKNOWN...
 remove_function_from_trace.pl: GPL-2, UNKNOWN...
 tests.c: GPL-2, UNKNOWN...
 tests-t.pl: GPL-2, UNKNOWN...
 dbug_add_tags.pl: GPL-2, 1979-2008 MySQL AB...
 dbug.c: public-domain, 1987 Abandoned Fred Fish...
 dbug_long.h: public-domain, 1987 Abandoned Fred Fish...
 dbug_analyze.c: public-domain, 1987 June Binayak Banerjee...
extra: 
 yassl: 
  src: 
   dummy.cpp: GPL-2, UNKNOWN...
 *: GPL-2, 1979-2008 MySQL AB...
include: 
 probes_mysql_nodtrace.h: GPL-2, UNKNOWN...
 *: GPL-2, 1979-2008 MySQL AB...
 t_ctype.h: GPL-2, 2000 MySQL AB...
libmysqld: 
 resource.h: GPL-2, UNKNOWN...
 *: GPL-2, 1979-2008 MySQL AB...
 lib_sql.cc: SWsoft, 2000 SWsoft  company...
mysql-test: 
 *: GPL-2, UNKNOWN...
 include: 
  have_perfschema.inc: GPL-2, 1979-2008 MySQL AB...
 lib: 
  mtr_cases.pm: GPL-2, 1979-2008 MySQL AB...
  mtr_gcov.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_gprof.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_io.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_match.pm: GPL-2, 1979-2008 MySQL AB...
  mtr_misc.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_process.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_report.pm: GPL-2, 1979-2008 MySQL AB...
  mtr_results.pm: GPL-2, 1979-2008 MySQL AB...
  mtr_stress.pl: GPL-2, 1979-2008 MySQL AB...
  mtr_unique.pm: GPL-2, 1979-2008 MySQL AB...
  My: 
   ConfigFactory.pm: GPL-2, 1979-2008 MySQL AB...
   Config.pm: GPL-2, 1979-2008 MySQL AB...
   CoreDump.pm: GPL-2, 1979-2008 MySQL AB...
   File: 
    *: GPL-2, 1979-2008 MySQL AB...
   Find.pm: GPL-2, 1979-2008 MySQL AB...
   Handles.pm: GPL-2, 1979-2008 MySQL AB...
   Options.pm: GPL-2, 1979-2008 MySQL AB...
   Platform.pm: GPL-2, 1979-2008 MySQL AB...
   SafeProcess: 
    Base.pm: GPL-2, 1979-2008 MySQL AB...
    safe_kill_win.cc: GPL-2, 1979-2008 MySQL AB...
    safe_process.cc: GPL-2, 1979-2008 MySQL AB...
    safe_process.pl: GPL-2, 1979-2008 MySQL AB...
    safe_process_win.cc: GPL-2, 1979-2008 MySQL AB...
   SafeProcess.pm: GPL-2, 1979-2008 MySQL AB...
   SysInfo.pm: GPL-2, 1979-2008 MySQL AB...
   Test.pm: GPL-2, 1979-2008 MySQL AB...
  t: 
   *: GPL-2, 1979-2008 MySQL AB...
  v1: 
   mtr_cases.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_gcov.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_gprof.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_im.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_io.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_match.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_misc.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_process.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_report.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_stress.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_timer.pl: GPL-2, 1979-2008 MySQL AB...
   mtr_unique.pl: GPL-2, 1979-2008 MySQL AB...
   My: 
    *: GPL-2, 1979-2008 MySQL AB...
   mysql-test-run.pl: GPL-2, 1979-2008 MySQL AB...
 mysql-stress-test.pl: GPL-2, 1979-2008 MySQL AB...
 mysql-test-run.pl: GPL-2, 1979-2008 MySQL AB...
 std_data: 
  *: GPL-2, 1979-2008 MySQL AB...
 suite: 
  perfschema: 
   include: 
    *: GPL-2, 1979-2008 MySQL AB...
  perfschema_stress: 
   include: 
    *: GPL-2, 1979-2008 MySQL AB...
regex: 
 *: GPL-2, UNKNOWN...
 regexp.c: BSD-like, 1986 University of Toronto...
sql-bench: 
 graph-compare-results.sh: GPL-2, UNKNOWN...
 *: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 innotest1.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
 innotest1a.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
 innotest1b.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
 innotest2.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
 innotest2a.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
 innotest2b.sh: GPL-2, 2000-2002 Innobase Oy & MySQL AB...
storage: 
 ndb: 
  bin: 
   *: GPL-2, UNKNOWN...
  demos: 
   *: GPL-2, UNKNOWN...
  test: 
   run-test: 
    atrt-analyze-result.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    atrt-clear-result.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    atrt-gather-result.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    atrt-setup.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    make-config.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    make-html-reports.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    make-index.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
    ndb-autotest.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
   src: 
    getarg.c: BSD (3 clause), 1997-2000 - Kungliga Tekniska HÃ¶gskolan...
   include: 
    getarg.h: BSD (3 clause) GPL-2, 2003 MySQL AB...
 *: GPL-2, 1979-2008 MySQL AB...
 innobase: 
  *: GPL-2, 1994-2011 Innobase Oy....
  btr: 
   btr0sea.c: GPL-2, 1995-1997,2009-2010 Innobase Oy....
   btr0cur.c: GPL-2, 1994-2011 Oracle and/or its affiliates....
  include: 
   log0log.h: GPL-2, 1995-1997,2009-2010 Innobase Oy....
   os0sync.h: GPL-2, 1995-1997,2009-2010 Innobase Oy....
   sync0rw.h: GPL-2, 1994-2011 Oracle and/or its affiliates....
   sync0sync.h: GPL-2, 1994-2011 Oracle and/or its affiliates....
   ut0bh.h: GPL-2, 1996,2010-2011 Oracle Corpn....
   pars0grm.h: GPL-2, 1995-2009 Innobase Oy....
   srv0srv.h: GPL-2, 1995-1996,2010-2011 Innobase Oy....
   os0file.h: GPL-2, 1995-2010 Innobase Oy....
  log: 
   log0log.c: GPL-2, 1995-1997,2009-2010 Innobase Oy....
  row: 
   row0sel.c: GPL-2, 1995-1997,2009-2010 Innobase Oy....
  buf: 
   buf0buf.c: GPL-2, 1994-2011 Oracle and/or its affiliates....
  sync: 
   *: GPL-2, 1994-2011 Oracle and/or its affiliates....
  trx: 
   trx0rseg.c: GPL-2, 1996,2010-2011 Oracle Corpn....
  ut: 
   ut0bh.c: GPL-2, 1996,2010-2011 Oracle Corpn....
   ut0ut.c: GPL-2, 1996,2010-2011 Oracle Corpn....
   ut0rbt.c: GPL-2, 2007-2010 Innobase Oy....
  pars: 
   pars0grm.c: GPL-2, 1995-2009 Innobase Oy....
  srv: 
   srv0start.c: GPL-2, 1995-1996,2010-2011 Innobase Oy....
   srv0srv.c: GPL-2, 2008-2009 Google Inc...
  os: 
   os0file.c: GPL-2, 1995-2010 Innobase Oy....
  handler: 
   ha_innodb.cc: GPL-2, 2008-2009 Google Inc...
   ha_innodb.h: GPL-2, 2000-2010 MySQL AB & Innobase Oy....
 myisam: 
  ftbench: 
   ft-test-run.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
  mi_test_all.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
  rt_index.h: GPL-2, 2000,2002-2006 MySQL AB & Ramil Kalimullin...
  rt_key.c: GPL-2, 2000,2002-2006 MySQL AB & Ramil Kalimullin...
  rt_mbr.c: GPL-2, 2000,2002-2006 MySQL AB & Ramil Kalimullin...
  rt_mbr.h: GPL-2, 2000,2002-2006 MySQL AB & Ramil Kalimullin...
  sp_defs.h: GPL-2, 2000,2002-2006 MySQL AB & Ramil Kalimullin...
 archive: 
  azio.c: zlib/libpng, 1995-2005 Jean-loup Gailly and Mark Adler...
  azlib.h: zlib/libpng, 1995-2005 Jean-loup Gailly and Mark Adler...
support-files: 
 binary-configure.sh: GPL-2, UNKNOWN...
 my-huge.cnf.sh: GPL-2, UNKNOWN...
 my-innodb-heavy-4G.cnf.sh: GPL-2, UNKNOWN...
 my-large.cnf.sh: GPL-2, UNKNOWN...
 my-medium.cnf.sh: GPL-2, UNKNOWN...
 my-small.cnf.sh: GPL-2, UNKNOWN...
 mysqld_multi.server.sh: GPL-2, UNKNOWN...
 mysql-log-rotate.sh: GPL-2, UNKNOWN...
 mysql.server-sys5.sh: GPL-2, UNKNOWN...
 config.huge.ini.sh: GPL-2, 1979-2008 MySQL AB...
 config.medium.ini.sh: GPL-2, 1979-2008 MySQL AB...
 config.small.ini.sh: GPL-2, 1979-2008 MySQL AB...
 MacOSX: 
  Description.plist.sh: GPL-2, 1979-2008 MySQL AB...
  Info.plist.sh: GPL-2, 1979-2008 MySQL AB...
  StartupParameters.plist.sh: GPL-2, 1979-2008 MySQL AB...
  postflight.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
  preflight.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 MySQL-shared-compat.spec.sh: GPL-2, 1979-2008 MySQL AB...
 mysql.spec.sh: GPL-2, 1979-2008 MySQL AB...
 ndb-config-2-node.ini.sh: GPL-2, 1979-2008 MySQL AB...
 mysql-multi.server.sh: public-domain, 1996 Abandoned TCX DataKonsult AB & Monty Program KB & Detron HB...
 mysql.server.sh: public-domain, 1996 Abandoned TCX DataKonsult AB & Monty Program KB & Detron HB...
BUILD: 
 *: GPL-2, 1979-2008 MySQL AB...
Docs: 
 *: GPL-2, 1979-2008 MySQL AB...
client: 
 *: GPL-2, 1979-2008 MySQL AB...
 echo.c: GPL-2, 1979-2008 MySQL AB...
 get_password.c: GPL-2, 1979-2008 MySQL AB...
 completion_hash.h: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
cmake: 
 *: GPL-2, 1979-2008 MySQL AB...
libmysql: 
 *: GPL-2, 1979-2008 MySQL AB...
libservices: 
 *: GPL-2, 1979-2008 MySQL AB...
mysys: 
 *: GPL-2, 1979-2008 MySQL AB...
packaging: 
 WiX: 
  ca: 
   *: GPL-2, 1979-2008 MySQL AB...
plugin: 
 audit_null: 
  *: GPL-2, 1979-2008 MySQL AB...
 auth: 
  *: GPL-2, 1979-2008 MySQL AB...
 daemon_example: 
  *: GPL-2, 1979-2008 MySQL AB...
 fulltext: 
  *: GPL-2, 1979-2008 MySQL AB...
 semisync: 
  semisync_slave.cc: GPL-2, 1979-2008 MySQL AB...
  semisync_slave.h: GPL-2, 1979-2008 MySQL AB...
  semisync.cc: GPL-2, 2008 MySQL AB...
  semisync.h: GPL-2, 2008 MySQL AB...
  semisync_slave_plugin.cc: GPL-2, 2008 MySQL AB...
  semisync_master.cc: GPL-2, 2008-2009 MySQL AB Sun Microsystems Inc...
  semisync_master_plugin.cc: GPL-2, 2008-2009 MySQL AB Sun Microsystems Inc...
  semisync_master.h: GPL-2, 2008-2009 MySQL AB Sun Microsystems Inc...
scripts: 
 *: GPL-2, 1979-2008 MySQL AB...
 mysqlaccess.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 mysql_fix_extensions.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 mysql_setpermission.sh: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 mysqld_safe.sh: public-domain, 1996 Abandoned TCX DataKonsult AB & Monty Program KB & Detron HB...
 dheadgen.pl: BSD (3 clause), 2008-2009 Sun Microsystems Inc...
 mysqldumpslow.sh: LGPL, 2000-2002,2005-2009 MySQL AB Sun Microsystems Inc...
sql: 
 *: GPL-2, 1979-2008 MySQL AB...
 sql_yacc.cc: GPL-2+, 1984,1989-1990,2000-2006 Free Software Foundation, Inc....
 sql_yacc.h: GPL-2+, 1984,1989-1990,2000-2006 Free Software Foundation, Inc....
 nt_servc.cc: public-domain, 1998 Abandoned Irena Pancirov - Irnet Snc...
 nt_servc.h: public-domain, 1998 Abandoned Irena Pancirov - Irnet Snc...
sql-common: 
 *: GPL-2, 1979-2008 MySQL AB...
strings: 
 *: GPL-2, 1979-2008 MySQL AB...
 strxmov.c: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 strxnmov.c: LGPL, 2000-2009 MySQL AB Sun Microsystems Inc...
 ctype-bin.c: LGPL, 2000,2002,2005-2011 Oracle and/or its affiliates. & tommy@valley.ne.jp...
 ctype-eucjpms.c: LGPL, 2000,2002,2005-2011 Oracle and/or its affiliates. & tommy@valley.ne.jp...
 ctype-ujis.c: LGPL, 2000,2002,2005-2011 Oracle and/or its affiliates. & tommy@valley.ne.jp...
 t_ctype.h: GPL-2, 2000 MySQL AB...
 ctype-win1250ch.c: GPL-2, 2002-2010 Oracle and/or its affiliates....
 ctype-tis620.c: GPL-2, 1998 Theppitak Karoonboonyanan <thep@links.nectec.or.th>...
 dtoa.c: LGPL, 2007-2010 Oracle and/or its affiliates....
tests: 
 *: GPL-2, 1979-2008 MySQL AB...
 mail_to_db.pl: public-domain, 1998 Abandoned TCX DataKonsult AB & Monty Program KB & Detron HB...
unittest: 
 *: GPL-2, 1979-2008 MySQL AB...
vio: 
 *: GPL-2, 1979-2008 MySQL AB...
zlib: 
 *: zlib/libpng, 1995-2005 Jean-loup Gailly and Mark Adler...
EOS

is_string($copyright->display, $s, 'compare output from big copyright file');
